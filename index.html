<script>
  document.addEventListener('DOMContentLoaded', function () {
    const beep = document.getElementById('beep');
    const audioPlayers = Array.from(document.querySelectorAll('audio[controls]')).filter(a => a !== beep);

    // URLs con proxy CORS (para pruebas)
    const proxies = {
      "La Fuerte": "https://cors-anywhere.herokuapp.com/http://panelautodj.innovatestream.pe:7322/statistics?json=1&nocache=",
      "La Jefa": "https://cors-anywhere.herokuapp.com/http://panelautodj.innovatestream.pe:7320/statistics?json=1&nocache=",
      "San Francisco": "https://cors-anywhere.herokuapp.com/http://panelautodj.innovatestream.pe:7324/statistics?json=1&nocache=",
      "Máxima": "https://cors-anywhere.herokuapp.com/http://panelautodj.innovatestream.pe:8342/statistics?json=1&nocache=",
      "La Cumbiambera": "https://cors-anywhere.herokuapp.com/http://panelautodj.innovatestream.pe:8464/statistics?json=1&nocache=",
      "La Raya": "https://cors-anywhere.herokuapp.com/http://panelautodj.innovatestream.pe:8466/statistics?json=1&nocache="
    };

    // Mapeo de radios con su card DOM y su URL
    const cards = Array.from(document.querySelectorAll('.card')).map(card => {
      const nombre = card.querySelector('h2').textContent.trim();
      return {
        card,
        nombre,
        url: proxies[nombre],
        tituloElem: document.createElement('p')
      };
    });

    // Agregar elemento para mostrar la canción debajo del título
    cards.forEach(({ card, tituloElem }) => {
      tituloElem.style.color = '#fff';
      tituloElem.style.fontWeight = '600';
      tituloElem.style.fontSize = '1rem';
      tituloElem.style.marginTop = '0.5rem';
      tituloElem.textContent = 'Cargando canción...';
      card.querySelector('h2').after(tituloElem);
    });

    // Función para actualizar títulos
    async function actualizarCanciones() {
      for (const { url, tituloElem } of cards) {
        try {
          const res = await fetch(url);
          if (!res.ok) throw new Error('Error en respuesta');

          const data = await res.json();

          // Dependiendo del formato JSON, buscar el nombre de la canción
          // Según el servidor Icecast, el título suele estar en data.source.title o data.icestats.source.title
          // Ajustamos según estructura (verifica que coincida)
          let titulo = '';
          if (data.icestats && data.icestats.source && data.icestats.source.title) {
            titulo = data.icestats.source.title;
          } else if (data.source && data.source.title) {
            titulo = data.source.title;
          } else {
            titulo = 'No disponible';
          }

          tituloElem.textContent = titulo || 'No disponible';

        } catch (error) {
          tituloElem.textContent = 'Error al cargar canción';
          console.error('Error al obtener canción:', error);
        }
      }
    }

    // Actualizar inicialmente y luego cada 10 segundos
    actualizarCanciones();
    setInterval(actualizarCanciones, 10000);

    // Código original para play/pause y animación activa
    audioPlayers.forEach(audio => {
      audio.addEventListener('play', () => {
        audioPlayers.forEach(other => {
          if (other !== audio) other.pause();
        });

        docum
